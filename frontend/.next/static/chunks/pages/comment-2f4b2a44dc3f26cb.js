(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{2806:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/comment",function(){return a(160)}])},160:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var r=a(5893),s=a(7294),n=a(381),c=a.n(n),i=a(7536),l=a(1163),o=a(4712),d=a(8633),m=a(80),p=e=>{var t;let{comment_id:a,userInfo:n}=e,l="http://13.51.34.110",[p,u]=(0,s.useState)([]),[x,f]=(0,s.useState)(new Date),{register:h,formState:{errors:y},handleSubmit:_,setValue:w}=(0,i.cI)({defaultValues:{created_at:new Date,reply_text:"",comment:0,created_by:0}}),j=async()=>{let e=await fetch("".concat(l,"/api/users/"),{method:"GET",headers:{"Content-Type":"json/application"}});return await e.json()};(0,s.useEffect)(()=>{void 0!=a&&(async e=>{let t=[],a=await fetch("".concat(l,"/api/reply-list/")),r=await a.json();if(r.length>0){let a=r.filter(t=>t.comment==e);for(let e=0;e<a.length;e++){let r=a[e],s="",n=[];(n=await j()).length>0&&(s=await n.filter(e=>{if(e.id==r.created_by)return e.first_name}));let c={reply_id:r.reply_id,reply_text:r.reply_text,created_at:r.created_at,created_by:s[0].first_name,like:r.like};t.push(c)}t.length>0&&u(t)}else u([])})(a)},[a]);let v=async(e,t)=>{t.preventDefault();let r=x.toISOString(),s=new FormData;s.append("reply_text",e.reply_text),s.append("comment",parseInt(a)),s.append("created_by",parseInt(n.user.id)),s.append("created_at",r);let c=await fetch("".concat(l,"/api/reply-create/"),{method:"POST",headers:{Authorization:"Token ".concat(n.token)},body:s}),i=await c.json();return"You don't have permission for this action"!=i?(o.A.success("Reply has been added."),w("reply_text",""),await fetchReplies(a),!0):(o.A.error(i),!1)},b=async e=>{if(200!=(await fetch("".concat(l,"/api/reply-delete/").concat(e),{method:"DELETE",headers:{AUTHORIZATION:"Token ".concat(n.token)}})).status)return o.A.error("There are issues to delete the record."),!1;o.A.success("Record has been deleted successfully."),await fetchReplies(a)};return(0,r.jsxs)("div",{className:"flex flex-col w-64 md:w-full px-4 ",children:[void 0!=n&&(0,r.jsx)("div",{children:(0,r.jsxs)("form",{children:[(0,r.jsxs)("div",{className:"flex justify-between lg:flex-row bg-gray-100 rounded-xl w-64 md:w-[500px]",children:[(0,r.jsx)("input",{type:"text",autoComplete:"reply_text",className:"px-2 py-2 outline-none bg-gray-100 rounded-xl flex w-[450px]",placeholder:"write your reply",...h("reply_text",{required:!0})}),(0,r.jsx)("button",{onClick:_(v),type:"button",className:"py-1 mr-2 cursor-pointer",children:(0,r.jsx)(d.lNF,{size:22})})]}),(0,r.jsx)("div",{className:"text-rose-400",children:(null===(t=y.reply_text)||void 0===t?void 0:t.type)==="required"&&"Reply is required"})]})}),p.length>0&&p.map((e,t)=>(0,r.jsx)("div",{className:"flex justify-start w-full items-center",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-center items-center px-4",children:[(0,r.jsx)("div",{className:"mr-6",children:e.created_by}),(0,r.jsx)("div",{children:c()(e.created_at).format("MMM DD, YYYY")}),(0,r.jsx)("div",{className:"ml-6",children:e.reply_text}),(0,r.jsx)("div",{className:"px-1 py-1 cursor-pointer text-rose-400",children:(0,r.jsx)(m.F1H,{onClick:()=>b(e.reply_id),size:22})})]})},t))]})},u=a(5451),x=e=>{var t;let{userInfo:a,post:n}=e;(0,l.useRouter)();let d="http://13.51.34.110",[x,f]=(0,s.useState)(new Date),[h,y]=(0,s.useState)([]),{register:_,formState:{errors:w},handleSubmit:j,setValue:v}=(0,i.cI)({defaultValues:{created_at:new Date,comment_text:"",post:0,created_by:0}}),b=async e=>{let t=[],a=await fetch("".concat(d,"/api/comment-list/")),r=await a.json();if(r.length>0){let a=r.filter(t=>t.post==e);for(let e=0;e<a.length;e++){let r=a[e],s="",n=[];(n=await N()).length>0&&(s=await n.filter(e=>{if(e.id==r.created_by)return e.first_name}));let c={comment_id:r.comment_id,comment_text:r.comment_text,created_at:r.created_at,created_by:s[0].first_name,post:r.post,like:r.like};t.push(c)}t.length>0&&y(t)}else y([])},N=async()=>{let e=await fetch("".concat(d,"/api/users/"),{method:"GET",headers:{"Content-Type":"json/application"}}),t=await e.json();return await t},g=async(e,t)=>{t.preventDefault();let r=x.toISOString(),s=new FormData;s.append("comment_text",e.comment_text),s.append("post",parseInt(n)),s.append("created_by",parseInt(a.user.id)),s.append("created_at",r);let c=await fetch("".concat(d,"/api/comment-create/"),{method:"POST",headers:{Authorization:"Token ".concat(a.token)},body:s}),i=await c.json();return(console.log(i),"You don't have permission for this action"!=i)?(o.A.success("Comment has been added."),v("comment_text",""),await b(n),!0):(o.A.error(i),!1)},k=async e=>{if(200!=(await fetch("".concat(d,"/api/comment-delete/").concat(e),{method:"DELETE",headers:{AUTHORIZATION:"Token ".concat(a.token)}})).status)return o.A.error("You don't have permission for this action"),!1;o.A.success("Record has been deleted successfully."),await b(n)};return(0,s.useEffect)(()=>{void 0!=n&&b(n)},[n]),(0,r.jsxs)("div",{className:"flex flex-col w-[290px] md:w-full ",children:[void 0!=a&&(0,r.jsx)("div",{children:(0,r.jsxs)("form",{children:[(0,r.jsxs)("div",{className:"flex justify-between lg:flex-row bg-gray-100 rounded-xl w-64 md:w-[500px]",children:[(0,r.jsx)("input",{type:"text",autoComplete:"comment_text",className:"px-2 py-2 outline-none bg-gray-100 rounded-xl flex w-[450px]",placeholder:"write your comment",..._("comment_text",{required:!0})}),(0,r.jsx)("button",{onClick:j(g),type:"button",className:"py-1 mr-2 cursor-pointer",children:(0,r.jsx)(u.XnA,{size:22})})]}),(0,r.jsx)("div",{className:"text-rose-400",children:(null===(t=w.comment_text)||void 0===t?void 0:t.type)==="required"&&"Comment is required"})]})}),h.length>0&&h.map(e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-start w-full items-center",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-center items-center px-4",children:[(0,r.jsx)("div",{className:"mr-6",children:e.created_by}),(0,r.jsx)("div",{children:c()(e.created_at).format("MMM DD, YYYY")}),(0,r.jsx)("div",{className:"ml-6",children:e.comment_text}),(0,r.jsx)("div",{className:"px-1 py-1 cursor-pointer text-rose-400",children:(0,r.jsx)("button",{children:(0,r.jsx)(m.F1H,{onClick:()=>k(e.comment_id),size:22})})})]})}),(0,r.jsx)("div",{className:"w-full md:px-4 py-1",children:(0,r.jsx)(p,{comment_id:e.comment_id,userInfo:a})})]}))]})},f=e=>(0,r.jsx)("div",{children:(0,r.jsx)(x,{userInfo:e.userInfo,post:e.post_id})})}},function(e){e.O(0,[838,738,845,885,536,774,888,179],function(){return e(e.s=2806)}),_N_E=e.O()}]);